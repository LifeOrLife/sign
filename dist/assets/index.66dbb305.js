!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(n){const i=new URL(t,location),o=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((n,s)=>{const c=new URL(t,i);if(self[e].moduleMap[c])return n(self[e].moduleMap[c]);const h=new Blob([`import * as m from '${c}';`,`${e}.moduleMap['${c}']=m;`],{type:"text/javascript"}),r=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(h),onerror(){s(new Error(`Failed to import: ${t}`)),o(r)},onload(){n(self[e].moduleMap[c]),o(r)}});document.head.appendChild(r)})),self[e].moduleMap={}}}("/assets/");function t(t){return document.querySelector(t)}const e=document.querySelector(".pen"),n=new class{constructor(t,e={}){if(!(t instanceof HTMLCanvasElement)){const e=window.getComputedStyle(t,null),n=document.createElement("canvas");n.style.width=e.width,n.style.height=e.height,t.appendChild(n),t=n}this.el=t;this.config=Object.assign({lineWidth:6,color:"#black"},e),this.stacks=[],this.move=t=>{if(this.canDraw){this.isMobile()&&(t.preventDefault(),t=t.touches[0]);const e={x:t.clientX-this.left_v,y:t.clientY-this.top_v},n=this.context;this.x=e.x,this.y=e.y,n.lineTo(e.x,e.y),this.current.push(e),n.stroke()}},this.up=()=>{this.canDraw&&this.stacks.push(this.current),this.canDraw=!1},this.down=t=>{if(2===t.button)return;const e={x:(t=this.isMobile()?t.touches[0]:t).clientX-this.left_v,y:t.clientY-this.top_v},n=this.context;this.canDraw=!0,this.x=e.x,this.y=e.y,n.beginPath(),this.current=[],this.current.push(e),n.moveTo(e.x,e.y)},this.contextmenu=t=>(t.preventDefault(),!1)}init(){const t=this.el,{width:e,height:n}=window.getComputedStyle(t,null),i=parseInt(e),o=parseInt(n);this.context=t.getContext("2d"),this.width=i,this.height=o;const s=this.context,c=window.devicePixelRatio;t.style.width=`${e}px`,t.style.height=`${n}px`,c?(t.height=o*c,t.width=i*c,s.scale(c,c)):(t.width=i,t.height=o),s.lineWidth=this.config.lineWidth,s.strokeStyle=this.config.color,s.lineCap="round",s.lineJoin="round",this.bindEvent(),this.addRecall(),this.getPositionValue()}getPositionValue(){const t=this.el.getBoundingClientRect();this.left_v=t.left,this.top_v=t.top}isMobile(){return/phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone/i.test(navigator.userAgent)}bindEvent(){const t=this.el;let e="mousedown",n="mousemove",i="mouseup";this.isMobile()&&(e="touchstart",n="touchmove",i="touchend"),t.addEventListener(e,this.down),document.addEventListener(n,this.move,{passive:!1}),document.addEventListener(i,this.up),t.addEventListener("contextmenu",this.contextmenu)}removeEvent(){const t=this.el;let e="mousedown",n="mousemove",i="mouseup";this.isMobile()&&(e="touchstart",n="touchmove",i="touchend"),t.removeEventListener(e,this.down),document.removeEventListener(n,this.move),document.removeEventListener(i,this.up),t.addEventListener("contextmenu",this.contextmenu)}addRecall(){document.addEventListener("keydown",(t=>{t.ctrlKey&&"KeyZ"===t.code&&this.rePatint()}))}rePatint(){const t=this.stacks.slice(0,-1);if(this.stacks=t,this.clear(),!this.stacks.length)return void console.log("没有内容");const e=this.context;this.stacks.forEach((t=>{const n=t[0];e.beginPath(),e.moveTo(n.x,n.y),t.slice(1).forEach((t=>{e.lineTo(t.x,t.y)})),e.stroke()}))}clear(){this.context.clearRect(0,0,this.width,this.height)}resetCanvas(){this.stacks=[],this.clear()}getPNGImage(){return this.el.toDataURL("image/png")}downloadPNGImage(){const t=this.dataURLtoBlob(this.getPNGImage()),e=URL.createObjectURL(t),n=document.createElement("a");n.download="test.png",n.href=e,n.click()}dataURLtoBlob(t){const e=t.split(","),n=e[0].match(/:(.*?);/)[1],i=atob(e[1]);let o=i.length;const s=new Uint8Array(o);for(;o--;)s[o]=i.charCodeAt(o);return new Blob([s],{type:n})}dataURLtoFile(t){const e=t.split(","),n=e[0].match(/:(.*?);/)[1],i=atob(e[1]);let o=i.length;const s=new Uint8Array(o);for(;o--;)s[o]=i.charCodeAt(o);return new File([s],"",{type:n})}}(e);n.init();const i=t(".download"),o=t(".revoke"),s=t(".clear");i.addEventListener("click",(()=>{n.downloadPNGImage()})),o.addEventListener("click",(()=>{n.rePatint()})),s.addEventListener("click",(()=>{n.resetCanvas()}));
